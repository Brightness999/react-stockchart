<!doctype html>
<html>
<head>
	<title>ClChart Demo</title>
	<meta data-n-head="true" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="description" content="A fast, simple, cross-platform, and configurable stock chart library created using canvas.">
	<meta name="keywords" content="chart, canvas, stock chart, fast, simple, cross-platform, configurable">
	<script src="./clchart.js"></script>
	<script src="./stockdata.js"></script>
	<link rel="stylesheet" type="text/css" href="./style.css" />
</head>

<body>
	<div class="container">
		<div class="header-container">
			<div class="menu-container">
				<label class="menu-label menu-item active" for="typeMenusCheck" id="typeLabel">分时(指数)</label>
				<input class="menu-check" type="checkbox" name="typeMenusCheck" id="typeMenusCheck">
				<ul class="menus" id="typeMenus">
					<li data-type="MIN" data-fc="SH000001" class="menu-item">分时(指数)</li>
					<li data-type="DAY5" data-fc="SH000001" class="menu-item">五日(指数)</li>
					<li data-type="MIN" data-fc="SZ300545" class="menu-item">分时</li>
					<li data-type="DAY5" data-fc="SZ300545" class="menu-item">五日</li>
					<li data-type="DAY" data-fc="SZ300545" class="menu-item">日K</li>
					<li data-type="WEEK" data-fc="SZ300545" class="menu-item">周线</li>
					<li data-type="MON" data-fc="SZ300545" class="menu-item">月线</li>
					<li data-type="M5" data-fc="SZ300545" class="menu-item">5分钟</li>
				</ul>
			</div>
		</div>
		<div class="chart-container">
			<canvas id="myChart" width="400" height="600"></canvas>
		</div>
	</div>
	<script>
		// 开始画图
		var canvas = document.getElementById('myChart');
		var ctx = canvas.getContext('2d');
		var syscfg = {
				canvas,
				scale: window.devicePixelRatio,
				context: ctx
		};
		if (Chart && Chart.clear) Chart.clear();
		var Chart = ClChart.createSingleChart(syscfg);
		// 画分钟线
		function handleMin(code) {
			console.log('Min Line');
			Chart.clear();
			Chart.initData(20180413, ClChart.DEF_DATA.STOCK_TRADETIME);
			Chart.setData('INFO', ClChart.DEF_DATA.FIELD_INFO, getMockData(code, 'INFO'));
			Chart.setData('MIN', ClChart.DEF_DATA.FIELD_MIN, getMockData(code, 'MIN'));
			Chart.setData('TICK', ClChart.DEF_DATA.FIELD_TICK, getMockData(code, 'TICK'));
			Chart.setData('NOW', ClChart.DEF_DATA.FIELD_NOW, getMockData(code, 'NOW'));
			var mainHeight = canvas.height * 2 / 3;
			var mainWidth = canvas.width * 3 / 4;
			if (code === 'SH000001') mainWidth = canvas.width;
			var usercfg = {
				layout: ClChart.DEF_CHART.CHART_LAYOUT,
				config: ClChart.DEF_CHART.CHART_NOW,
				rectMain: {
					left: 0,
					top: 0,
					width: mainWidth,
					height: mainHeight,
				}
			};
			 var Chart1 = Chart.createChart('MIN', 'CHART.LINE', usercfg, function(result) { 
				//  console.log(result); 
				});
			Chart.bindData(Chart1, 'MIN');

			usercfg = {
				layout: ClChart.DEF_CHART.CHART_LAYOUT,
				config: ClChart.DEF_CHART.CHART_NOWVOL,
				rectMain: {
					left: 0,
					top: mainHeight,
					width: mainWidth,
					height: canvas.height - mainHeight,
				}
			};
			var Chart2 = Chart.createChart('MINNOW', 'CHART.LINE', usercfg, function(result) { 
				//  console.log(result); 
				});
			Chart.bindData(Chart2, 'MIN');

			if (code !== 'SH000001') {
				usercfg = {
				layout: ClChart.DEF_CHART.CHART_LAYOUT,
				config: ClChart.DEF_CHART.CHART_ORDER,
				rectMain: {
					left: mainWidth,
					top: 0,
					width: canvas.width - mainWidth,
					height: canvas.height,
				}
			};
			var Chart3 = Chart.createChart('ORDER', 'CHART.ORDER', usercfg, function(result) { 
				//  console.log(result); 
				});
			// Chart.bindData(Chart3, 'TICK');
			}

			Chart.onPaint();
		}
		// 画五日线
		function handleFiveDay(code) {
			console.log('Five Day Line');
			Chart.clear();
			Chart.initData(20180413, ClChart.DEF_DATA.STOCK_TRADETIME);
			Chart.setData('INFO', ClChart.DEF_DATA.FIELD_INFO, getMockData(code, 'INFO'));
			Chart.setData('DAY5', ClChart.DEF_DATA.FIELD_DAY5, getMockData(code, 'DAY5'));
			Chart.setData('MIN', ClChart.DEF_DATA.FIELD_MIN, getMockData(code, 'MIN'));
			var mainHeight = canvas.height * 2 / 3;
			var usercfg = {
				layout: ClChart.DEF_CHART.CHART_LAYOUT,
				config: ClChart.DEF_CHART.CHART_DAY5,
				rectMain: {
					left: 0,
					top: 0,
					width: canvas.width,
					height: mainHeight,
				}
			};
			 var KBarChart = Chart.createChart('DAY5', 'CHART.LINE', usercfg, function(result) { 
				//  console.log(result); 
				});
			Chart.bindData(KBarChart, 'DAY5');

			usercfg = {
				layout: ClChart.DEF_CHART.CHART_LAYOUT,
				config: ClChart.DEF_CHART.CHART_DAY5VOL,
				rectMain: {
					left: 0,
					top: mainHeight,
					width: canvas.width,
					height: canvas.height - mainHeight,
				}
			};
			var KVBarChart = Chart.createChart('VLINE5', 'CHART.LINE', usercfg, function(result) { 
				//  console.log(result); 
				});
			Chart.bindData(KVBarChart, 'DAY5');

			Chart.onPaint();
		}
		// 画日线
		function handleKline(fullCode, peroid) {
			let source = peroid;
 			if (peroid ==='WEEK'||peroid==='MON') source = 'DAY';
			Chart.clear();
			Chart.initData(20180413, ClChart.DEF_DATA.STOCK_TRADETIME);
			Chart.setData('INFO', ClChart.DEF_DATA.FIELD_INFO, getMockData('SZ300545', 'INFO'));
			Chart.setData('RIGHT', ClChart.DEF_DATA.FIELD_RIGHT, getMockData('SZ300545', 'RIGHT'));
			Chart.setData(source, ClChart.DEF_DATA.FIELD_DAY, getMockData('SZ300545', source));
			var mainHeight = canvas.height * 2 / 3;
			// var layout = ClChart.DEF_CHART.CHART_LAYOUT;
			// var layout = ClChart.DEF_CHART.CHART_LAYOUT;
			var usercfg = {
				layout: {
					offset : {
						left: 5,
						right: 50
					}
				},
				buttons: ClChart.DEF_CHART.CHART_BUTTONS,
				config: ClChart.DEF_CHART.CHART_KBAR,
				rectMain: {
					left: 0,
					top: 0,
					width: canvas.width,
					height: mainHeight,
				}
			};
			 var KBarChart = Chart.createChart('KBAR', 'CHART.LINE', usercfg, function(result) { 
				//  console.log(result); 
				});
			Chart.bindData(KBarChart, peroid);

			usercfg = {
				layout: {
					offset : {
						left: 5,
						right: 50
					}
				},
				config: ClChart.DEF_CHART.CHART_VBAR,
				rectMain: {
					left: 0,
					top: mainHeight,
					width: canvas.width,
					height: canvas.height - mainHeight,
				}
			};
			var KVBarChart = Chart.createChart('VBAR', 'CHART.LINE', usercfg, function(result) { 
				//  console.log(result); 
				});
			Chart.bindData(KVBarChart, peroid);

			Chart.onPaint();
		}


		const menuTypes = {
			MIN: handleMin,
			DAY5: handleFiveDay,
			MIN: handleMin,
			DAY5: handleFiveDay,
			DAY: handleKline,
			WEEK: handleKline,
			MON: handleKline,
			M5: handleKline
		}

		function setMenusChecked(id, checked) {
			var dom = document.getElementById(id);
			if (dom) {
				dom.checked = checked;
			}
		}
		function setDomTxt(id, txt) {
			var dom = document.getElementById(id);
			if (dom) {
				dom.innerHTML = txt;
			}
		}
		function setMenusActive(menuId, activeDom) {
			var dom = document.getElementById(menuId);
			var menuItems = dom.getElementsByTagName('li');
			for (let i = 0; i < menuItems.length; i++) {
				const element = menuItems[i];
				element.className = element.className.replace(' active', '');
			}
			if (activeDom) {
				activeDom.className = activeDom.className + ' active';
			}
		}

		// 画图
		function drawChart(data) {
			data = data || {};
			var drawFunc = menuTypes[data.type];
			if (typeof drawFunc === 'function') {
				drawFunc(data.fc, data.type);
			}
		}

		var activeData = {
			type: 'MIN',
			fc: 'SH000001'
		};
		window.onload = function () {
			drawChart(activeData);
			var typeMenuDom = document.getElementById('typeMenus');
			typeMenuDom.addEventListener('click', function(e) {
				var activeMenu = e.target;
				if (!activeMenu) {
					return;
				}
				activeData = activeMenu.dataset || {};
				drawChart(activeData);
				setMenusChecked('typeMenusCheck', false);
				setMenusActive('typeMenus', activeMenu);
				setDomTxt('typeLabel', activeMenu.innerHTML);
			})
		};		
		
	</script>
</body>

</html>