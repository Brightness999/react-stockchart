<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>data/cl.data.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ClChart.html">ClChart</a><ul class='methods'><li data-type='method'><a href="ClChart.html#.bindData">bindData</a></li><li data-type='method'><a href="ClChart.html#.clear">clear</a></li><li data-type='method'><a href="ClChart.html#.createChart">createChart</a></li><li data-type='method'><a href="ClChart.html#.fastDrawBegin">fastDrawBegin</a></li><li data-type='method'><a href="ClChart.html#.fastDrawEnd">fastDrawEnd</a></li><li data-type='method'><a href="ClChart.html#.getChart">getChart</a></li><li data-type='method'><a href="ClChart.html#.getData">getData</a></li><li data-type='method'><a href="ClChart.html#.getDataLayer">getDataLayer</a></li><li data-type='method'><a href="ClChart.html#.getEventLayer">getEventLayer</a></li><li data-type='method'><a href="ClChart.html#.initChart">initChart</a></li><li data-type='method'><a href="ClChart.html#.initData">initData</a></li><li data-type='method'><a href="ClChart.html#.onPaint">onPaint</a></li><li data-type='method'><a href="ClChart.html#.readyData">readyData</a></li><li data-type='method'><a href="ClChart.html#.setColor">setColor</a></li><li data-type='method'><a href="ClChart.html#.setData">setData</a></li><li data-type='method'><a href="ClChart.html#.setDataLayer">setDataLayer</a></li><li data-type='method'><a href="ClChart.html#.setHideInfo">setHideInfo</a></li><li data-type='method'><a href="ClChart.html#.setStandard">setStandard</a></li></ul></li><li><a href="ClChartButton.html">ClChartButton</a><ul class='methods'><li data-type='method'><a href="ClChartButton.html#.checkConfig">checkConfig</a></li><li data-type='method'><a href="ClChartButton.html#.onClick">onClick</a></li><li data-type='method'><a href="ClChartButton.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClChartLine.html">ClChartLine</a><ul class='methods'><li data-type='method'><a href="ClChartLine.html#.beforeLocation">beforeLocation</a></li><li data-type='method'><a href="ClChartLine.html#.calcMaxMin">calcMaxMin</a></li><li data-type='method'><a href="ClChartLine.html#.checkConfig">checkConfig</a></li><li data-type='method'><a href="ClChartLine.html#.createButton">createButton</a></li><li data-type='method'><a href="ClChartLine.html#.drawChildCharts">drawChildCharts</a></li><li data-type='method'><a href="ClChartLine.html#.drawChildDraw">drawChildDraw</a></li><li data-type='method'><a href="ClChartLine.html#.drawChildLines">drawChildLines</a></li><li data-type='method'><a href="ClChartLine.html#.drawClear">drawClear</a></li><li data-type='method'><a href="ClChartLine.html#.drawTitleInfo">drawTitleInfo</a></li><li data-type='method'><a href="ClChartLine.html#.getDataRange">getDataRange</a></li><li data-type='method'><a href="ClChartLine.html#.getLineDataKey">getLineDataKey</a></li><li data-type='method'><a href="ClChartLine.html#.getMiddle">getMiddle</a></li><li data-type='method'><a href="ClChartLine.html#.getMouseMoveData">getMouseMoveData</a></li><li data-type='method'><a href="ClChartLine.html#.getMoveData">getMoveData</a></li><li data-type='method'><a href="ClChartLine.html#.hasButton">hasButton</a></li><li data-type='method'><a href="ClChartLine.html#.init">init</a></li><li data-type='method'><a href="ClChartLine.html#.locationData">locationData</a></li><li data-type='method'><a href="ClChartLine.html#.onClick">onClick</a></li><li data-type='method'><a href="ClChartLine.html#.onKeyDown">onKeyDown</a></li><li data-type='method'><a href="ClChartLine.html#.onLongPress">onLongPress</a></li><li data-type='method'><a href="ClChartLine.html#.onMouseMove">onMouseMove</a></li><li data-type='method'><a href="ClChartLine.html#.onMouseOut">onMouseOut</a></li><li data-type='method'><a href="ClChartLine.html#.onMouseWheel">onMouseWheel</a></li><li data-type='method'><a href="ClChartLine.html#.onPaint">onPaint</a></li><li data-type='method'><a href="ClChartLine.html#.onPinch">onPinch</a></li><li data-type='method'><a href="ClChartLine.html#.readyDraw">readyDraw</a></li><li data-type='method'><a href="ClChartLine.html#.readyScroll">readyScroll</a></li><li data-type='method'><a href="ClChartLine.html#.removeLine">removeLine</a></li><li data-type='method'><a href="ClChartLine.html#.setButtons">setButtons</a></li><li data-type='method'><a href="ClChartLine.html#.setChildDraw">setChildDraw</a></li><li data-type='method'><a href="ClChartLine.html#.setChildLines">setChildLines</a></li><li data-type='method'><a href="ClChartLine.html#.setHotButton">setHotButton</a></li><li data-type='method'><a href="ClChartLine.html#.setPublicRect">setPublicRect</a></li><li data-type='method'><a href="ClChartLine.html#.setScroll">setScroll</a></li><li data-type='method'><a href="ClChartLine.html#.setZoomInfo">setZoomInfo</a></li></ul></li><li><a href="ClChartOrder.html">ClChartOrder</a><ul class='methods'><li data-type='method'><a href="ClChartOrder.html#.checkConfig">checkConfig</a></li><li data-type='method'><a href="ClChartOrder.html#.drawClear">drawClear</a></li><li data-type='method'><a href="ClChartOrder.html#.drawGridLine">drawGridLine</a></li><li data-type='method'><a href="ClChartOrder.html#.drawIndex">drawIndex</a></li><li data-type='method'><a href="ClChartOrder.html#.drawOrder">drawOrder</a></li><li data-type='method'><a href="ClChartOrder.html#.drawReady">drawReady</a></li><li data-type='method'><a href="ClChartOrder.html#.drawTick">drawTick</a></li><li data-type='method'><a href="ClChartOrder.html#.getColor">getColor</a></li><li data-type='method'><a href="ClChartOrder.html#.init">init</a></li><li data-type='method'><a href="ClChartOrder.html#.onClick">onClick</a></li><li data-type='method'><a href="ClChartOrder.html#.onPaint">onPaint</a></li><li data-type='method'><a href="ClChartOrder.html#.setPublicRect">setPublicRect</a></li></ul></li><li><a href="ClChartScroll.html">ClChartScroll</a><ul class='methods'><li data-type='method'><a href="ClChartScroll.html#.checkConfig">checkConfig</a></li><li data-type='method'><a href="ClChartScroll.html#.checkMin">checkMin</a></li><li data-type='method'><a href="ClChartScroll.html#.drawClear">drawClear</a></li><li data-type='method'><a href="ClChartScroll.html#.drawGridline">drawGridline</a></li><li data-type='method'><a href="ClChartScroll.html#.findMouseIndex">findMouseIndex</a></li><li data-type='method'><a href="ClChartScroll.html#.init">init</a></li><li data-type='method'><a href="ClChartScroll.html#.onChange">onChange</a></li><li data-type='method'><a href="ClChartScroll.html#.onInit">onInit</a></li><li data-type='method'><a href="ClChartScroll.html#.onMouseDown">onMouseDown</a></li><li data-type='method'><a href="ClChartScroll.html#.onMouseMove">onMouseMove</a></li><li data-type='method'><a href="ClChartScroll.html#.onMouseOut">onMouseOut</a></li><li data-type='method'><a href="ClChartScroll.html#.onMouseUp">onMouseUp</a></li><li data-type='method'><a href="ClChartScroll.html#.onPaint">onPaint</a></li><li data-type='method'><a href="ClChartScroll.html#.setPublicRect">setPublicRect</a></li></ul></li><li><a href="ClData.html">ClData</a><ul class='methods'><li data-type='method'><a href="ClData.html#.clearData">clearData</a></li><li data-type='method'><a href="ClData.html#.flushMin">flushMin</a></li><li data-type='method'><a href="ClData.html#.flushNowData">flushNowData</a></li><li data-type='method'><a href="ClData.html#.flushTick">flushTick</a></li><li data-type='method'><a href="ClData.html#.getData">getData</a></li><li data-type='method'><a href="ClData.html#.initData">initData</a></li><li data-type='method'><a href="ClData.html#.makeLineData">makeLineData</a></li><li data-type='method'><a href="ClData.html#.makeMinute">makeMinute</a></li><li data-type='method'><a href="ClData.html#.mergeDay">mergeDay</a></li><li data-type='method'><a href="ClData.html#.mergeDay5">mergeDay5</a></li><li data-type='method'><a href="ClData.html#.mergeMon">mergeMon</a></li><li data-type='method'><a href="ClData.html#.mergeNowMinToMin">mergeNowMinToMin</a></li><li data-type='method'><a href="ClData.html#.mergeWeek">mergeWeek</a></li><li data-type='method'><a href="ClData.html#.setData">setData</a></li><li data-type='method'><a href="ClData.html#.updateMinute">updateMinute</a></li></ul></li><li><a href="ClDrawAxisX.html">ClDrawAxisX</a><ul class='methods'><li data-type='method'><a href="ClDrawAxisX.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawAxisY.html">ClDrawAxisY</a><ul class='methods'><li data-type='method'><a href="ClDrawAxisY.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawCursor.html">ClDrawCursor</a><ul class='methods'><li data-type='method'><a href="ClDrawCursor.html#.onClear">onClear</a></li><li data-type='method'><a href="ClDrawCursor.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawGrid.html">ClDrawGrid</a><ul class='methods'><li data-type='method'><a href="ClDrawGrid.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawInfo.html">ClDrawInfo</a><ul class='methods'><li data-type='method'><a href="ClDrawInfo.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawKBar.html">ClDrawKBar</a><ul class='methods'><li data-type='method'><a href="ClDrawKBar.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawLine.html">ClDrawLine</a><ul class='methods'><li data-type='method'><a href="ClDrawLine.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawRight.html">ClDrawRight</a><ul class='methods'><li data-type='method'><a href="ClDrawRight.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawSeer.html">ClDrawSeer</a><ul class='methods'><li data-type='method'><a href="ClDrawSeer.html#.beforeLocation">beforeLocation</a></li><li data-type='method'><a href="ClDrawSeer.html#.drawHotSeer">drawHotSeer</a></li><li data-type='method'><a href="ClDrawSeer.html#.drawTransRect">drawTransRect</a></li><li data-type='method'><a href="ClDrawSeer.html#.filterSeer">filterSeer</a></li><li data-type='method'><a href="ClDrawSeer.html#.getSeerPos">getSeerPos</a></li><li data-type='method'><a href="ClDrawSeer.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawTrade.html">ClDrawTrade</a><ul class='methods'><li data-type='method'><a href="ClDrawTrade.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawVBar.html">ClDrawVBar</a><ul class='methods'><li data-type='method'><a href="ClDrawVBar.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawVLine.html">ClDrawVLine</a><ul class='methods'><li data-type='method'><a href="ClDrawVLine.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClEvent.html">ClEvent</a><ul class='methods'><li data-type='method'><a href="ClEvent.html#.bindChart">bindChart</a></li><li data-type='method'><a href="ClEvent.html#.boardEvent">boardEvent</a></li><li data-type='method'><a href="ClEvent.html#.clearEvent">clearEvent</a></li><li data-type='method'><a href="ClEvent.html#.emitEvent">emitEvent</a></li><li data-type='method'><a href="ClEvent.html#.findEventPath">findEventPath</a></li><li data-type='method'><a href="ClEvent.html#.getMousePos">getMousePos</a></li></ul></li><li><a href="ClEventHandler.html">ClEventHandler</a><ul class='methods'><li data-type='method'><a href="ClEventHandler.html#.addHandler">addHandler</a></li><li data-type='method'><a href="ClEventHandler.html#.bindEvent">bindEvent</a></li><li data-type='method'><a href="ClEventHandler.html#.clearEvent">clearEvent</a></li><li data-type='method'><a href="ClEventHandler.html#.clearHandler">clearHandler</a></li><li data-type='method'><a href="ClEventHandler.html#.click">click</a></li><li data-type='method'><a href="ClEventHandler.html#.keydown">keydown</a></li><li data-type='method'><a href="ClEventHandler.html#.keyup">keyup</a></li><li data-type='method'><a href="ClEventHandler.html#.mousedown">mousedown</a></li><li data-type='method'><a href="ClEventHandler.html#.mousein">mousein</a></li><li data-type='method'><a href="ClEventHandler.html#.mousemove">mousemove</a></li><li data-type='method'><a href="ClEventHandler.html#.mouseout">mouseout</a></li><li data-type='method'><a href="ClEventHandler.html#.mouseup">mouseup</a></li><li data-type='method'><a href="ClEventHandler.html#.mousewheel">mousewheel</a></li><li data-type='method'><a href="ClEventHandler.html#.touchend">touchend</a></li><li data-type='method'><a href="ClEventHandler.html#.touchmove">touchmove</a></li><li data-type='method'><a href="ClEventHandler.html#.touchstart">touchstart</a></li></ul></li><li><a href="ClFormula.html">ClFormula</a><ul class='methods'><li data-type='method'><a href="ClFormula.html#getValue">getValue</a></li><li data-type='method'><a href="ClFormula.html#MA">MA</a></li><li data-type='method'><a href="ClFormula.html#runSingleStock">runSingleStock</a></li></ul></li><li><a href="ClFormula_ClFormula.html">ClFormula</a></li><li><a href="EV.html">EV</a><ul class='methods'><li data-type='method'><a href="EV.html#.addEventListener">addEventListener</a></li><li data-type='method'><a href="EV.html#.emit">emit</a></li><li data-type='method'><a href="EV.html#.emitWithScope">emitWithScope</a></li><li data-type='method'><a href="EV.html#.once">once</a></li><li data-type='method'><a href="EV.html#.removeAllListeners">removeAllListeners</a></li><li data-type='method'><a href="EV.html#.removeEventListener">removeEventListener</a></li></ul></li><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Modules</h3><ul><li><a href="module-ChartTools.html">ChartTools</a><ul class='methods'><li data-type='method'><a href="module-ChartTools.html#.findLabelToIndex">findLabelToIndex</a></li><li data-type='method'><a href="module-ChartTools.html#.findNearTimeToIndex">findNearTimeToIndex</a></li><li data-type='method'><a href="module-ChartTools.html#.setFixedLineFlags">setFixedLineFlags</a></li><li data-type='method'><a href="module-ChartTools.html#.setMoveLineFlags">setMoveLineFlags</a></li></ul></li><li><a href="module-ClChart.html">ClChart</a><ul class='methods'><li data-type='method'><a href="module-ClChart.html#.createMulChart">createMulChart</a></li><li data-type='method'><a href="module-ClChart.html#.createSingleChart">createSingleChart</a></li></ul></li><li><a href="module-ClChartDef.html">ClChartDef</a></li><li><a href="module-ClTool.html">ClTool</a><ul class='methods'><li data-type='method'><a href="module-ClTool.html#.addPreZero">addPreZero</a></li><li data-type='method'><a href="module-ClTool.html#.getDate">getDate</a></li><li data-type='method'><a href="module-ClTool.html#.getMTime">getMTime</a></li></ul></li><li><a href="module-DrawUtils.html">DrawUtils</a><ul class='methods'><li data-type='method'><a href="module-DrawUtils.html#._BezierEllipse">_BezierEllipse</a></li><li data-type='method'><a href="module-DrawUtils.html#._clearRect">_clearRect</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawBegin">_drawBegin</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawCircle">_drawCircle</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawDashLine">_drawDashLine</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawEnd">_drawEnd</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawHline">_drawHline</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawKBar">_drawKBar</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawline">_drawline</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawLineAlone">_drawLineAlone</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawlineTo">_drawlineTo</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawLogo">_drawLogo</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawmoveTo">_drawmoveTo</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawRect">_drawRect</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawSignCircle">_drawSignCircle</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawSignHLine">_drawSignHLine</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawSignPlot">_drawSignPlot</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawSignVLine">_drawSignVLine</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawTxt">_drawTxt</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawTxtRect">_drawTxtRect</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawVBar">_drawVBar</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawVline">_drawVline</a></li><li data-type='method'><a href="module-DrawUtils.html#._fill">_fill</a></li><li data-type='method'><a href="module-DrawUtils.html#._fillRect">_fillRect</a></li><li data-type='method'><a href="module-DrawUtils.html#._getImageData">_getImageData</a></li><li data-type='method'><a href="module-DrawUtils.html#._getLineWidth">_getLineWidth</a></li><li data-type='method'><a href="module-DrawUtils.html#._getTxtWidth">_getTxtWidth</a></li><li data-type='method'><a href="module-DrawUtils.html#._putImageData">_putImageData</a></li><li data-type='method'><a href="module-DrawUtils.html#._setFontSize">_setFontSize</a></li><li data-type='method'><a href="module-DrawUtils.html#._setLineWidth">_setLineWidth</a></li><li data-type='method'><a href="module-DrawUtils.html#._setTransColor">_setTransColor</a></li><li data-type='method'><a href="module-DrawUtils.html#~__getTxtRect">__getTxtRect</a></li><li data-type='method'><a href="module-DrawUtils.html#~_drawCircleAndFilled">_drawCircleAndFilled</a></li><li data-type='method'><a href="module-DrawUtils.html#~getTxtWith">getTxtWith</a></li></ul></li><li><a href="module-GetValue.html">GetValue</a><ul class='methods'><li data-type='method'><a href="module-GetValue.html#.checkDay5">checkDay5</a></li><li data-type='method'><a href="module-GetValue.html#.checkDayZero">checkDayZero</a></li><li data-type='method'><a href="module-GetValue.html#.checkZero">checkZero</a></li><li data-type='method'><a href="module-GetValue.html#.findDateInDay">findDateInDay</a></li><li data-type='method'><a href="module-GetValue.html#.findIndexInMin">findIndexInMin</a></li><li data-type='method'><a href="module-GetValue.html#.fromIndexToTradeTime">fromIndexToTradeTime</a></li><li data-type='method'><a href="module-GetValue.html#.fromTradeTimeToIndex">fromTradeTimeToIndex</a></li><li data-type='method'><a href="module-GetValue.html#.getExrightPriceRange">getExrightPriceRange</a></li><li data-type='method'><a href="module-GetValue.html#.getMinuteCount">getMinuteCount</a></li><li data-type='method'><a href="module-GetValue.html#.getSize">getSize</a></li><li data-type='method'><a href="module-GetValue.html#.getValueMax">getValueMax</a></li><li data-type='method'><a href="module-GetValue.html#.getValueMin">getValueMin</a></li><li data-type='method'><a href="module-GetValue.html#.getZipDay">getZipDay</a></li><li data-type='method'><a href="module-GetValue.html#.matchDayToMon">matchDayToMon</a></li><li data-type='method'><a href="module-GetValue.html#.matchDayToWeek">matchDayToWeek</a></li><li data-type='method'><a href="module-GetValue.html#.outputDay5">outputDay5</a></li><li data-type='method'><a href="module-GetValue.html#.transExrightDay">transExrightDay</a></li><li data-type='method'><a href="module-GetValue.html#.transExrightMin">transExrightMin</a></li><li data-type='method'><a href="module-GetValue.html#.updateStatic">updateStatic</a></li><li data-type='method'><a href="module-GetValue.html#~_getExrightPara">_getExrightPara</a></li><li data-type='method'><a href="module-GetValue.html#~_getExrightPrice">_getExrightPrice</a></li><li data-type='method'><a href="module-GetValue.html#~_isRight">_isRight</a></li></ul></li><li><a href="module-SeerConfig.html">SeerConfig</a></li><li><a href="module-SystemConfig.html">SystemConfig</a><ul class='methods'><li data-type='method'><a href="module-SystemConfig.html#._getOtherTxtWidth">_getOtherTxtWidth</a></li><li data-type='method'><a href="module-SystemConfig.html#.changeCursorStyle">changeCursorStyle</a></li><li data-type='method'><a href="module-SystemConfig.html#.checkLayout">checkLayout</a></li><li data-type='method'><a href="module-SystemConfig.html#.getLineColor">getLineColor</a></li><li data-type='method'><a href="module-SystemConfig.html#.initCommonInfo">initCommonInfo</a></li><li data-type='method'><a href="module-SystemConfig.html#.initSystem">initSystem</a></li><li data-type='method'><a href="module-SystemConfig.html#.setColor">setColor</a></li><li data-type='method'><a href="module-SystemConfig.html#.setScale">setScale</a></li><li data-type='method'><a href="module-SystemConfig.html#.setStandard">setStandard</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#_getDistance">_getDistance</a></li><li><a href="global.html#_getRotateDirection">_getRotateDirection</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">data/cl.data.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Copyright (c) 2018-present clchart Contributors.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

// 以下是ClData的实体定义
// 一般只用操作这个类就可以获取单个股票的所有数据
// 不支持多个股票的数据，对于列表来说，这里只保存ID列表，其他的数据由实际画图自行获取，

import {
  fromTradeTimeToIndex,
  fromIndexToTradeTime,
  checkZero,
  getSize,
  checkDayZero,
  checkDay5,
  updateStatic,
  findDateInDay,
  findIndexInMin,
  matchDayToWeek,
  matchDayToMon,
  getMinuteCount,
  transExrightMin,
  transExrightDay
} from './cl.data.tools'
import {
  FIELD_INFO,
  FIELD_DAY,
  FIELD_MIN,
  FIELD_TICK,
  FIELD_DAY5,
  FIELD_NOW,
  FIELD_ILINE,
  FIELD_ENOW
} from '../cl.data.def'
import {
  getDate,
  isEmptyArray,
  copyArrayOfDeep
} from '../util/cl.tool'
import {
  ClFormula
} from '../formula/cl.formula'
// 只保存一只股票的信息，当前日期，开收市时间

/**
 * Class representing ClData
 * data layer
 * @export
 * @class ClData
 */
export default class ClData {
  /**
   * Creates an instance of ClData.

   */
  constructor () {
    // this.formula = new ClFormula();
    this.static = {
      stktype: 1,
      volunit: 100,
      coinunit: 100,
      decimal: 2,
      before: 1000,
      stophigh: 1100,
      stoplow: 900
    }
  }

  // 只保存一只股票的信息，当前日期，开收市时间
  /**
   * init data
   * @param {Number} tradeDate
   * @param {Number} tradetime
   * @memberof ClData
   */
  initData (tradeDate, tradetime) {
    this.formula = new ClFormula()
    this.clearData()
    if (tradetime === undefined) {
      this.tradeTime = [{
        begin: 930,
        end: 1130
      },
      {
        begin: 1300,
        end: 1500
      }
      ]
    } else {
      this.tradeTime = tradetime
    }

    if (tradeDate === undefined) {
      this.tradeDate = getDate() // 得到当天的日期
    } else {
      this.tradeDate = tradeDate // 最近一个交易日期，并不一定等于今天的日期，比如节假日期间
    }
  }
  // 包含一个股票所有的数据,以便于以后做公式系统也使用这个数据定义
  /**
   * clear data
   * @memberof ClData
   */
  clearData () {
    this.InData = [] // 数据 json格式数据 {key:..,fields:.., value:[[],[]...]}
    this.OutData = [] // 专门用于获取数据时临时产生的数据
  }
  // 下面是设置数据的方法
  /**
   * set data
   * @param {String} key
   * @param {Object} fields
   * @param {Array} value
   * @memberof ClData
   */
  setData (key, fields, value) {
    if (value === undefined) value = []
    if (this.InData[key] === undefined) this.InData[key] = {}
    switch (key) {
      case 'DAY5':
        value = checkDay5(value, this.static.coinzoom, this.tradeDate, this.tradeTime)
        break
      case 'NOW':
      case 'ENOW':
        this.flushNowData(key, value)
        break
      case 'MIN':
      case 'DAY':
        value = checkDayZero(value, this.tradeDate)
        break
      case 'INFO':
        this.static = updateStatic(FIELD_INFO, value)
        break
    }
    // // 设置了CODE或者INFO后，把一些常用的数取出来放到static中
    // 仅仅接收以上和 MIN5 RIGHT 等原始数据，周月年和其他周期分钟线，全部通过计算获取
    this.InData[key] = {
      key,
      fields
    }
    this.InData[key].value = copyArrayOfDeep(value)
  }
  /**
   * flush tick
   * @param {Array} nowdata
   * @param {Array} fields
   * @memberof ClData
   */
  flushTick (nowdata, fields) {
    // if (this.static.stktype == 0) return ;
    if (getSize(this.InData['TICK']) &lt; 1) {
      if (nowdata[fields.vol] > 0) {
        this.InData['TICK'] = {
          key: 'TICK',
          fields: FIELD_TICK,
          value: [nowdata[fields.time], nowdata[fields.close], nowdata[fields.vol]]
        }
      }
    } else {
      if (this.InData['TICK'].value[this.InData['TICK'].value.length - 1][FIELD_TICK.vol] &lt; nowdata[fields.vol] ||
        this.InData['TICK'].value[this.InData['TICK'].value.length - 1][FIELD_TICK.close] !== nowdata[fields.close]) {
        // 成交量变化才生成tick,或收盘价不一样
        this.InData['TICK'].value.push([nowdata[fields.time], nowdata[fields.close], nowdata[fields.vol]])
      }
    }
  }
  /**
   * flush min data
   * @param {Array} nowdata
   * @param {Array} fields
   * @memberof ClData
   */
  flushMin (nowdata, fields) {
    if (this.InData['MIN'] === undefined) {
      this.InData['MIN'] = {
        key: 'MIN',
        fields: FIELD_MIN,
        value: [
          fromTradeTimeToIndex(nowdata[fields.time], this.tradeTime),
          nowdata[fields.open],
          nowdata[fields.high],
          nowdata[fields.low],
          nowdata[fields.close],
          nowdata[fields.vol],
          nowdata[fields.money]
        ]
      }
    } else {
      const index = fromTradeTimeToIndex(nowdata[fields.time], this.tradeTime)
      const checked = findIndexInMin(this.InData['MIN'], index)
      if (checked.status === 'old') {
        if (this.InData['MIN'].value[checked.index][fields.high] &lt; nowdata[fields.close]) {
          this.InData['MIN'].value[checked.index][fields.high] = nowdata[fields.close]
        }
        if (this.InData['MIN'].value[checked.index][fields.low] > nowdata[fields.close]) {
          this.InData['MIN'].value[checked.index][fields.low] = nowdata[fields.close]
        }
        this.InData['MIN'].value[checked.index][fields.close] = nowdata[fields.close]
        this.InData['MIN'].value[checked.index][fields.vol] = nowdata[fields.vol]
        this.InData['MIN'].value[checked.index][fields.money] = nowdata[fields.money]
      } else if (checked.status === 'new') {
        this.InData['MIN'].value.push([index, nowdata[fields.close], nowdata[fields.close],
          nowdata[fields.close], nowdata[fields.close], nowdata[fields.vol], nowdata[fields.money]
        ])
      }
    }
  }
  // 当有新的NOW进来时，需要对TICK和当日MIN线进行更新，
  /**
   * flush now data
   * @param {String} key
   * @param {Array} nowdata
   * @memberof ClData
   */
  flushNowData (key, nowdata) {
    if (nowdata.length &lt; 1) return
    let fields = FIELD_NOW
    if (key === 'ENOW') fields = FIELD_ENOW
    if (checkZero(nowdata, fields)) return

    // 先处理TICK
    this.flushTick(nowdata, fields)

    // 再处理Min
    this.flushMin(nowdata, fields)
  }

  // 下面是获取数据的方法,先从OutData获取，没有数据就从InData数据中获取

  /**
   * get data
   * @param {String} key
   * @param {String} rightMode
   * @return {Array}
   * @memberof ClData
   */
  getData (key, rightMode) {
    switch (key) {
      case 'DAY':
        this.OutData['DAY'] = {
          key,
          fields: FIELD_DAY
        }
        this.OutData['DAY'].value = this.mergeDay(this.InData['DAY'], this.InData['NOW'], rightMode)
        // 对原始数据不做变更
        break
      case 'WEEK':
        this.OutData['WEEK'] = {
          key,
          fields: FIELD_DAY
        }
        this.OutData['WEEK'].value = this.mergeWeek(this.InData['DAY'], this.InData['NOW'], rightMode)
        // 每次都从日线计算生成 -- 避免除权数据无法正确显示的错误
        break
      case 'MON':
        this.OutData['MON'] = {
          key,
          fields: FIELD_DAY
        }
        this.OutData['MON'].value = this.mergeMon(this.InData['DAY'], this.InData['NOW'], rightMode)
        // 每次都从日线计算生成 -- 避免除权数据无法正确显示的错误
        break
      case 'DAY5':
        this.OutData['DAY5'] = {
          key,
          fields: FIELD_DAY5
        }
        this.OutData['DAY5'].value = this.mergeDay5(this.InData['DAY5'], this.InData['MIN'])
        // 每次都从日线计算生成
        break
      case 'M5':
      case 'M15':
      case 'M30':
      case 'M60':
        this.OutData[key] = {
          key,
          fields: FIELD_DAY
        }
        this.OutData[key].value = this.makeMinute(key, this.InData[key], this.InData['MIN'], rightMode)
        break
      case 'MIN':
        this.OutData[key] = {
          key,
          fields: FIELD_MIN
        }
        this.OutData[key].value = this.updateMinute(this.InData[key])
        break
    }
    // 先找Out中的数据，没有就找In的数据
    return this.OutData[key] ? this.OutData[key] : this.InData[key]
  }
  /**
   * update minute
   * @param {Object} source
   * @return {Array}
   * @memberof ClData
   */
  updateMinute (source) {
    let out = copyArrayOfDeep(source.value)

    let allmoney
    for (let k = 0; k &lt; out.length; k++) {
      if (this.static.stktype === 0) {
        if (k === 0) {
          allmoney = out[k][FIELD_MIN.vol] * out[k][FIELD_MIN.close]
        } else {
          allmoney += (out[k][FIELD_MIN.vol] - out[k - 1][FIELD_MIN.vol]) * out[k][FIELD_MIN.close]
        }
        out[k][FIELD_MIN.allmoney] = allmoney
      } else {
        // value[k][fields.allmoney] = value[k][fields.money];
      }
    }
    return out
  }
  /**
   * merge day
   * @param {Object} source
   * @param {Array} now
   * @param {String} rightMode
   * @return {Array}
   * @memberof ClData
   */
  mergeDay (source, now, rightMode) {
    let out = copyArrayOfDeep(source.value)
    if (now !== undefined &amp;&amp; !checkZero(now.value, now.fields)) {
      const checked = findDateInDay(source, getDate(now.value[now.fields.time]))
      if (checked.finded) {
        out[checked.index] = [
          getDate(now.value[now.fields.time]),
          now.value[now.fields.open],
          now.value[now.fields.high],
          now.value[now.fields.low],
          now.value[now.fields.close],
          now.value[now.fields.vol],
          now.value[now.fields.money]
        ]
      } else {
        out.push([
          getDate(now.value[now.fields.time]),
          now.value[now.fields.open],
          now.value[now.fields.high],
          now.value[now.fields.low],
          now.value[now.fields.close],
          now.value[now.fields.vol],
          now.value[now.fields.money]
        ])
      }
    }
    if (this.InData['RIGHT'] &amp;&amp; rightMode !== 'none') {
      out = transExrightDay(out, this.InData['RIGHT'].value, rightMode,
        0, out.length - 1)
    }
    // this.config.start,this.config.stop);

    return out
  }
  /**
   * merge week data
   * @param {Object} source
   * @param {Array} now
   * @param {String} rightmode
   * @return {Array}
   * @memberof ClData
   */
  mergeWeek (source, now, rightmode) {
    const out = this.mergeDay(source, now, rightmode)
    return matchDayToWeek(out)
    // 合并周线
  }
  /**
   * merge month data
   * @param {Object} source
   * @param {Array} now
   * @param {String} rightmode
   * @return {Array}
   * @memberof ClData
   */
  mergeMon (source, now, rightmode) {
    const out = this.mergeDay(source, now, rightmode)
    return matchDayToMon(out)
    // 合并月线
  }
  /**
   * merge 5 day data
   * @param {Object} source
   * @param {Array} min
   * @return {Array}
   * @memberof ClData
   */
  mergeDay5 (source, min) {
    let out = []

    if (source !== undefined &amp;&amp; !isEmptyArray(source.value)) {
      out = copyArrayOfDeep(source.value)
      const lastDate = getDate(source.value[source.value.length - 1][source.fields.time])
      if (lastDate === this.tradeDate) {
        return out
      }
    }
    if (min === undefined || isEmptyArray(min.value)) {
      return out
    }
    const daymins = getMinuteCount(this.tradeTime) * 4
    let money
    for (let k = 0; k &lt; min.value.length; k++) {
      if (this.static.stktype === 0) {
        if (k === 0) {
          money = min.value[k][min.fields.vol] * min.value[k][min.fields.close]
        } else {
          money += (min.value[k][min.fields.vol] - min.value[k - 1][min.fields.vol]) * min.value[k][min.fields.close]
        }
      } else {
        money = min.value[k][min.fields.money]
      }
      out.push([
        fromIndexToTradeTime(min.value[k][min.fields.idx], this.tradeTime, this.tradeDate),
        min.value[k][min.fields.close],
        k === 0 ? min.value[k][min.fields.vol] : min.value[k][min.fields.vol] - min.value[k - 1][min.fields.vol],
        daymins + min.value[k][min.fields.idx],
        min.value[k][min.fields.vol],
        money
      ])
    }
    return out
  }
  // source历史分钟线 nowmin当日分钟线
  /**
   * make minute data
   * @param {String} outkey
   * @param {Object} source
   * @param {Array} nowmin
   * @param {String} rightMode
   * @return {Array}
   * @memberof ClData
   */
  makeMinute (outkey, source, nowmin, rightMode) {
    let out = []
    if (source !== undefined &amp;&amp; !isEmptyArray(source.value)) {
      out = copyArrayOfDeep(source.value)
      out = transExrightMin(out, this.static.coinzoom, this.InData['RIGHT'].value, rightMode,
        // this.config.start,this.config.stop);
        0, out.length - 1)

      const lastDate = getDate(source.value[source.value.length - 1][source.fields.time])
      if (lastDate === this.tradeDate) {
        // 已经是最新的数据了
        return out
      }
    }
    // 没有原始数据或者未收市，需要把当日的nowmin合并
    if (nowmin !== undefined &amp;&amp; !isEmptyArray(nowmin.value)) {
      let offset = 5
      if (outkey === 'M15') offset = 15
      if (outkey === 'M30') offset = 30
      if (outkey === 'M60') offset = 60
      out = this.mergeNowMinToMin(out, nowmin, offset) // 当日的分钟线转成分钟线，索引转时间的问题
    }
    // out = matchMinToMinute(out, outkey);
    return out
  }
  /**
   * merge now's min data to min data
   * @param {Object} source
   * @param {Array} min
   * @param {Number} offset
   * @return {Array}
   * @memberof ClData
   */
  mergeNowMinToMin (source, min, offset) {
    const curMin = []
    let sumVol = 0
    let sumMoney = 0

    let hasData = false
    let stopIdx = 4

    for (let k = 0; k &lt; min.value.length; k++) {
      const curIndex = min.value[k][min.fields.idx]
      if (curIndex &lt; 0) continue
      if (curIndex > stopIdx) {
        if (hasData) {
          curMin[min.fields.vol] = min.value[k][min.fields.vol] - sumVol
          curMin[min.fields.money] = min.value[k][min.fields.money] - sumMoney
          sumVol = min.value[k][min.fields.vol]
          sumMoney = min.value[k][min.fields.money]

          curMin[min.fields.time] = fromIndexToTradeTime(stopIdx, this.tradeTime, this.tradeDate)
          source.push(copyArrayOfDeep(curMin))
        }
        stopIdx = (Math.floor(curIndex / offset) + 1) * offset - 1
        curMin[min.fields.open] = min.value[k][min.fields.open]
        curMin[min.fields.high] = min.value[k][min.fields.high]
        curMin[min.fields.low] = min.value[k][min.fields.low]
        curMin[min.fields.close] = min.value[k][min.fields.close]
        hasData = true
      } else { // curIndex 在0-5之间
        if (hasData) {
          curMin[min.fields.high] = curMin[min.fields.high] > min.value[k][min.fields.high]
            ? curMin[min.fields.high] : min.value[k][min.fields.high]
          curMin[min.fields.low] = curMin[min.fields.low] &lt; min.value[k][min.fields.low] ||
            min.value[k][min.fields.low] === 0
            ? curMin[min.fields.low] : min.value[k][min.fields.low]
          curMin[min.fields.close] = min.value[k][min.fields.close]
        } else {
          curMin[min.fields.open] = min.value[k][min.fields.open]
          curMin[min.fields.high] = min.value[k][min.fields.high]
          curMin[min.fields.low] = min.value[k][min.fields.low]
          curMin[min.fields.close] = min.value[k][min.fields.close]
          hasData = true
        }
      }
    } // for i
    if (hasData) {
      curMin[min.fields.vol] = min.value[min.value.length - 1][min.fields.vol] - sumVol
      curMin[min.fields.money] = min.value[min.value.length - 1][min.fields.money] - sumMoney
      curMin[min.fields.time] = fromIndexToTradeTime(stopIdx, this.tradeTime, this.tradeDate)
      source.push(copyArrayOfDeep(curMin))
    }
    return source
  }

  //  以下为公式系统，自由计算的定义

  /**
   * make lien data
   * @param {Object} source
   * @param {String} outkey
   * @param {String} formula
   * @return {Array}
   * @memberof ClData
   */
  makeLineData (source, outkey, formula) {
    const value = this.formula.runSingleStock(source, formula)
    if (this.OutData[outkey] === undefined) {
      this.OutData[outkey] = {
        outkey,
        fields: FIELD_ILINE,
        value
      }
    } else {
      this.OutData[outkey].value = value
      // 返回的值都是真实的值，不用再除单位了，具体显示几个小数点，由坐标的类别来定，
    }
    return this.OutData[outkey]
  }
} // end.
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Nov 11 2018 17:20:33 GMT+0800 (CST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>


</body>
</html>
