<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>event/cl.event.handler.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ClChart.html">ClChart</a><ul class='methods'><li data-type='method'><a href="ClChart.html#.bindData">bindData</a></li><li data-type='method'><a href="ClChart.html#.clear">clear</a></li><li data-type='method'><a href="ClChart.html#.createChart">createChart</a></li><li data-type='method'><a href="ClChart.html#.fastDrawBegin">fastDrawBegin</a></li><li data-type='method'><a href="ClChart.html#.fastDrawEnd">fastDrawEnd</a></li><li data-type='method'><a href="ClChart.html#.getChart">getChart</a></li><li data-type='method'><a href="ClChart.html#.getData">getData</a></li><li data-type='method'><a href="ClChart.html#.getDataLayer">getDataLayer</a></li><li data-type='method'><a href="ClChart.html#.getEventLayer">getEventLayer</a></li><li data-type='method'><a href="ClChart.html#.initChart">initChart</a></li><li data-type='method'><a href="ClChart.html#.initData">initData</a></li><li data-type='method'><a href="ClChart.html#.onPaint">onPaint</a></li><li data-type='method'><a href="ClChart.html#.readyData">readyData</a></li><li data-type='method'><a href="ClChart.html#.setColor">setColor</a></li><li data-type='method'><a href="ClChart.html#.setData">setData</a></li><li data-type='method'><a href="ClChart.html#.setDataLayer">setDataLayer</a></li><li data-type='method'><a href="ClChart.html#.setHideInfo">setHideInfo</a></li><li data-type='method'><a href="ClChart.html#.setStandard">setStandard</a></li></ul></li><li><a href="ClChartButton.html">ClChartButton</a><ul class='methods'><li data-type='method'><a href="ClChartButton.html#.checkConfig">checkConfig</a></li><li data-type='method'><a href="ClChartButton.html#.onClick">onClick</a></li><li data-type='method'><a href="ClChartButton.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClChartLine.html">ClChartLine</a><ul class='methods'><li data-type='method'><a href="ClChartLine.html#.beforeLocation">beforeLocation</a></li><li data-type='method'><a href="ClChartLine.html#.calcMaxMin">calcMaxMin</a></li><li data-type='method'><a href="ClChartLine.html#.checkConfig">checkConfig</a></li><li data-type='method'><a href="ClChartLine.html#.createButton">createButton</a></li><li data-type='method'><a href="ClChartLine.html#.drawChildCharts">drawChildCharts</a></li><li data-type='method'><a href="ClChartLine.html#.drawChildDraw">drawChildDraw</a></li><li data-type='method'><a href="ClChartLine.html#.drawChildLines">drawChildLines</a></li><li data-type='method'><a href="ClChartLine.html#.drawClear">drawClear</a></li><li data-type='method'><a href="ClChartLine.html#.drawTitleInfo">drawTitleInfo</a></li><li data-type='method'><a href="ClChartLine.html#.getDataRange">getDataRange</a></li><li data-type='method'><a href="ClChartLine.html#.getLineDataKey">getLineDataKey</a></li><li data-type='method'><a href="ClChartLine.html#.getMiddle">getMiddle</a></li><li data-type='method'><a href="ClChartLine.html#.getMouseMoveData">getMouseMoveData</a></li><li data-type='method'><a href="ClChartLine.html#.getMoveData">getMoveData</a></li><li data-type='method'><a href="ClChartLine.html#.hasButton">hasButton</a></li><li data-type='method'><a href="ClChartLine.html#.init">init</a></li><li data-type='method'><a href="ClChartLine.html#.locationData">locationData</a></li><li data-type='method'><a href="ClChartLine.html#.onClick">onClick</a></li><li data-type='method'><a href="ClChartLine.html#.onKeyDown">onKeyDown</a></li><li data-type='method'><a href="ClChartLine.html#.onLongPress">onLongPress</a></li><li data-type='method'><a href="ClChartLine.html#.onMouseMove">onMouseMove</a></li><li data-type='method'><a href="ClChartLine.html#.onMouseOut">onMouseOut</a></li><li data-type='method'><a href="ClChartLine.html#.onMouseWheel">onMouseWheel</a></li><li data-type='method'><a href="ClChartLine.html#.onPaint">onPaint</a></li><li data-type='method'><a href="ClChartLine.html#.onPinch">onPinch</a></li><li data-type='method'><a href="ClChartLine.html#.readyDraw">readyDraw</a></li><li data-type='method'><a href="ClChartLine.html#.readyScroll">readyScroll</a></li><li data-type='method'><a href="ClChartLine.html#.removeLine">removeLine</a></li><li data-type='method'><a href="ClChartLine.html#.setButtons">setButtons</a></li><li data-type='method'><a href="ClChartLine.html#.setChildDraw">setChildDraw</a></li><li data-type='method'><a href="ClChartLine.html#.setChildLines">setChildLines</a></li><li data-type='method'><a href="ClChartLine.html#.setHotButton">setHotButton</a></li><li data-type='method'><a href="ClChartLine.html#.setPublicRect">setPublicRect</a></li><li data-type='method'><a href="ClChartLine.html#.setScroll">setScroll</a></li><li data-type='method'><a href="ClChartLine.html#.setZoomInfo">setZoomInfo</a></li></ul></li><li><a href="ClChartOrder.html">ClChartOrder</a><ul class='methods'><li data-type='method'><a href="ClChartOrder.html#.checkConfig">checkConfig</a></li><li data-type='method'><a href="ClChartOrder.html#.drawClear">drawClear</a></li><li data-type='method'><a href="ClChartOrder.html#.drawGridLine">drawGridLine</a></li><li data-type='method'><a href="ClChartOrder.html#.drawIndex">drawIndex</a></li><li data-type='method'><a href="ClChartOrder.html#.drawOrder">drawOrder</a></li><li data-type='method'><a href="ClChartOrder.html#.drawReady">drawReady</a></li><li data-type='method'><a href="ClChartOrder.html#.drawTick">drawTick</a></li><li data-type='method'><a href="ClChartOrder.html#.getColor">getColor</a></li><li data-type='method'><a href="ClChartOrder.html#.init">init</a></li><li data-type='method'><a href="ClChartOrder.html#.onClick">onClick</a></li><li data-type='method'><a href="ClChartOrder.html#.onPaint">onPaint</a></li><li data-type='method'><a href="ClChartOrder.html#.setPublicRect">setPublicRect</a></li></ul></li><li><a href="ClChartScroll.html">ClChartScroll</a><ul class='methods'><li data-type='method'><a href="ClChartScroll.html#.checkConfig">checkConfig</a></li><li data-type='method'><a href="ClChartScroll.html#.checkMin">checkMin</a></li><li data-type='method'><a href="ClChartScroll.html#.drawClear">drawClear</a></li><li data-type='method'><a href="ClChartScroll.html#.drawGridline">drawGridline</a></li><li data-type='method'><a href="ClChartScroll.html#.findMouseIndex">findMouseIndex</a></li><li data-type='method'><a href="ClChartScroll.html#.init">init</a></li><li data-type='method'><a href="ClChartScroll.html#.onChange">onChange</a></li><li data-type='method'><a href="ClChartScroll.html#.onInit">onInit</a></li><li data-type='method'><a href="ClChartScroll.html#.onMouseDown">onMouseDown</a></li><li data-type='method'><a href="ClChartScroll.html#.onMouseMove">onMouseMove</a></li><li data-type='method'><a href="ClChartScroll.html#.onMouseOut">onMouseOut</a></li><li data-type='method'><a href="ClChartScroll.html#.onMouseUp">onMouseUp</a></li><li data-type='method'><a href="ClChartScroll.html#.onPaint">onPaint</a></li><li data-type='method'><a href="ClChartScroll.html#.setPublicRect">setPublicRect</a></li></ul></li><li><a href="ClData.html">ClData</a><ul class='methods'><li data-type='method'><a href="ClData.html#.clearData">clearData</a></li><li data-type='method'><a href="ClData.html#.flushMin">flushMin</a></li><li data-type='method'><a href="ClData.html#.flushNowData">flushNowData</a></li><li data-type='method'><a href="ClData.html#.flushTick">flushTick</a></li><li data-type='method'><a href="ClData.html#.getData">getData</a></li><li data-type='method'><a href="ClData.html#.initData">initData</a></li><li data-type='method'><a href="ClData.html#.makeLineData">makeLineData</a></li><li data-type='method'><a href="ClData.html#.makeMinute">makeMinute</a></li><li data-type='method'><a href="ClData.html#.mergeDay">mergeDay</a></li><li data-type='method'><a href="ClData.html#.mergeDay5">mergeDay5</a></li><li data-type='method'><a href="ClData.html#.mergeMon">mergeMon</a></li><li data-type='method'><a href="ClData.html#.mergeNowMinToMin">mergeNowMinToMin</a></li><li data-type='method'><a href="ClData.html#.mergeWeek">mergeWeek</a></li><li data-type='method'><a href="ClData.html#.setData">setData</a></li><li data-type='method'><a href="ClData.html#.updateMinute">updateMinute</a></li></ul></li><li><a href="ClDrawAxisX.html">ClDrawAxisX</a><ul class='methods'><li data-type='method'><a href="ClDrawAxisX.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawAxisY.html">ClDrawAxisY</a><ul class='methods'><li data-type='method'><a href="ClDrawAxisY.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawCursor.html">ClDrawCursor</a><ul class='methods'><li data-type='method'><a href="ClDrawCursor.html#.onClear">onClear</a></li><li data-type='method'><a href="ClDrawCursor.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawGrid.html">ClDrawGrid</a><ul class='methods'><li data-type='method'><a href="ClDrawGrid.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawInfo.html">ClDrawInfo</a><ul class='methods'><li data-type='method'><a href="ClDrawInfo.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawKBar.html">ClDrawKBar</a><ul class='methods'><li data-type='method'><a href="ClDrawKBar.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawLine.html">ClDrawLine</a><ul class='methods'><li data-type='method'><a href="ClDrawLine.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawRight.html">ClDrawRight</a><ul class='methods'><li data-type='method'><a href="ClDrawRight.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawSeer.html">ClDrawSeer</a><ul class='methods'><li data-type='method'><a href="ClDrawSeer.html#.beforeLocation">beforeLocation</a></li><li data-type='method'><a href="ClDrawSeer.html#.drawHotSeer">drawHotSeer</a></li><li data-type='method'><a href="ClDrawSeer.html#.drawTransRect">drawTransRect</a></li><li data-type='method'><a href="ClDrawSeer.html#.filterSeer">filterSeer</a></li><li data-type='method'><a href="ClDrawSeer.html#.getSeerPos">getSeerPos</a></li><li data-type='method'><a href="ClDrawSeer.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawTrade.html">ClDrawTrade</a><ul class='methods'><li data-type='method'><a href="ClDrawTrade.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawVBar.html">ClDrawVBar</a><ul class='methods'><li data-type='method'><a href="ClDrawVBar.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClDrawVLine.html">ClDrawVLine</a><ul class='methods'><li data-type='method'><a href="ClDrawVLine.html#.onPaint">onPaint</a></li></ul></li><li><a href="ClEvent.html">ClEvent</a><ul class='methods'><li data-type='method'><a href="ClEvent.html#.bindChart">bindChart</a></li><li data-type='method'><a href="ClEvent.html#.boardEvent">boardEvent</a></li><li data-type='method'><a href="ClEvent.html#.clearEvent">clearEvent</a></li><li data-type='method'><a href="ClEvent.html#.emitEvent">emitEvent</a></li><li data-type='method'><a href="ClEvent.html#.findEventPath">findEventPath</a></li><li data-type='method'><a href="ClEvent.html#.getMousePos">getMousePos</a></li></ul></li><li><a href="ClEventHandler.html">ClEventHandler</a><ul class='methods'><li data-type='method'><a href="ClEventHandler.html#.addHandler">addHandler</a></li><li data-type='method'><a href="ClEventHandler.html#.bindEvent">bindEvent</a></li><li data-type='method'><a href="ClEventHandler.html#.clearEvent">clearEvent</a></li><li data-type='method'><a href="ClEventHandler.html#.clearHandler">clearHandler</a></li><li data-type='method'><a href="ClEventHandler.html#.click">click</a></li><li data-type='method'><a href="ClEventHandler.html#.keydown">keydown</a></li><li data-type='method'><a href="ClEventHandler.html#.keyup">keyup</a></li><li data-type='method'><a href="ClEventHandler.html#.mousedown">mousedown</a></li><li data-type='method'><a href="ClEventHandler.html#.mousein">mousein</a></li><li data-type='method'><a href="ClEventHandler.html#.mousemove">mousemove</a></li><li data-type='method'><a href="ClEventHandler.html#.mouseout">mouseout</a></li><li data-type='method'><a href="ClEventHandler.html#.mouseup">mouseup</a></li><li data-type='method'><a href="ClEventHandler.html#.mousewheel">mousewheel</a></li><li data-type='method'><a href="ClEventHandler.html#.touchend">touchend</a></li><li data-type='method'><a href="ClEventHandler.html#.touchmove">touchmove</a></li><li data-type='method'><a href="ClEventHandler.html#.touchstart">touchstart</a></li></ul></li><li><a href="ClFormula.html">ClFormula</a><ul class='methods'><li data-type='method'><a href="ClFormula.html#getValue">getValue</a></li><li data-type='method'><a href="ClFormula.html#MA">MA</a></li><li data-type='method'><a href="ClFormula.html#runSingleStock">runSingleStock</a></li></ul></li><li><a href="ClFormula_ClFormula.html">ClFormula</a></li><li><a href="EV.html">EV</a><ul class='methods'><li data-type='method'><a href="EV.html#.addEventListener">addEventListener</a></li><li data-type='method'><a href="EV.html#.emit">emit</a></li><li data-type='method'><a href="EV.html#.emitWithScope">emitWithScope</a></li><li data-type='method'><a href="EV.html#.once">once</a></li><li data-type='method'><a href="EV.html#.removeAllListeners">removeAllListeners</a></li><li data-type='method'><a href="EV.html#.removeEventListener">removeEventListener</a></li></ul></li><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Modules</h3><ul><li><a href="module-ChartTools.html">ChartTools</a><ul class='methods'><li data-type='method'><a href="module-ChartTools.html#.findLabelToIndex">findLabelToIndex</a></li><li data-type='method'><a href="module-ChartTools.html#.findNearTimeToIndex">findNearTimeToIndex</a></li><li data-type='method'><a href="module-ChartTools.html#.setFixedLineFlags">setFixedLineFlags</a></li><li data-type='method'><a href="module-ChartTools.html#.setMoveLineFlags">setMoveLineFlags</a></li></ul></li><li><a href="module-ClChart.html">ClChart</a><ul class='methods'><li data-type='method'><a href="module-ClChart.html#.createMulChart">createMulChart</a></li><li data-type='method'><a href="module-ClChart.html#.createSingleChart">createSingleChart</a></li></ul></li><li><a href="module-ClChartDef.html">ClChartDef</a></li><li><a href="module-ClTool.html">ClTool</a><ul class='methods'><li data-type='method'><a href="module-ClTool.html#.addPreZero">addPreZero</a></li><li data-type='method'><a href="module-ClTool.html#.getDate">getDate</a></li><li data-type='method'><a href="module-ClTool.html#.getMTime">getMTime</a></li></ul></li><li><a href="module-DrawUtils.html">DrawUtils</a><ul class='methods'><li data-type='method'><a href="module-DrawUtils.html#._BezierEllipse">_BezierEllipse</a></li><li data-type='method'><a href="module-DrawUtils.html#._clearRect">_clearRect</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawBegin">_drawBegin</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawCircle">_drawCircle</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawDashLine">_drawDashLine</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawEnd">_drawEnd</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawHline">_drawHline</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawKBar">_drawKBar</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawline">_drawline</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawLineAlone">_drawLineAlone</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawlineTo">_drawlineTo</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawLogo">_drawLogo</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawmoveTo">_drawmoveTo</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawRect">_drawRect</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawSignCircle">_drawSignCircle</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawSignHLine">_drawSignHLine</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawSignPlot">_drawSignPlot</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawSignVLine">_drawSignVLine</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawTxt">_drawTxt</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawTxtRect">_drawTxtRect</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawVBar">_drawVBar</a></li><li data-type='method'><a href="module-DrawUtils.html#._drawVline">_drawVline</a></li><li data-type='method'><a href="module-DrawUtils.html#._fill">_fill</a></li><li data-type='method'><a href="module-DrawUtils.html#._fillRect">_fillRect</a></li><li data-type='method'><a href="module-DrawUtils.html#._getImageData">_getImageData</a></li><li data-type='method'><a href="module-DrawUtils.html#._getLineWidth">_getLineWidth</a></li><li data-type='method'><a href="module-DrawUtils.html#._getTxtWidth">_getTxtWidth</a></li><li data-type='method'><a href="module-DrawUtils.html#._putImageData">_putImageData</a></li><li data-type='method'><a href="module-DrawUtils.html#._setFontSize">_setFontSize</a></li><li data-type='method'><a href="module-DrawUtils.html#._setLineWidth">_setLineWidth</a></li><li data-type='method'><a href="module-DrawUtils.html#._setTransColor">_setTransColor</a></li><li data-type='method'><a href="module-DrawUtils.html#~__getTxtRect">__getTxtRect</a></li><li data-type='method'><a href="module-DrawUtils.html#~_drawCircleAndFilled">_drawCircleAndFilled</a></li><li data-type='method'><a href="module-DrawUtils.html#~getTxtWith">getTxtWith</a></li></ul></li><li><a href="module-GetValue.html">GetValue</a><ul class='methods'><li data-type='method'><a href="module-GetValue.html#.checkDay5">checkDay5</a></li><li data-type='method'><a href="module-GetValue.html#.checkDayZero">checkDayZero</a></li><li data-type='method'><a href="module-GetValue.html#.checkZero">checkZero</a></li><li data-type='method'><a href="module-GetValue.html#.findDateInDay">findDateInDay</a></li><li data-type='method'><a href="module-GetValue.html#.findIndexInMin">findIndexInMin</a></li><li data-type='method'><a href="module-GetValue.html#.fromIndexToTradeTime">fromIndexToTradeTime</a></li><li data-type='method'><a href="module-GetValue.html#.fromTradeTimeToIndex">fromTradeTimeToIndex</a></li><li data-type='method'><a href="module-GetValue.html#.getExrightPriceRange">getExrightPriceRange</a></li><li data-type='method'><a href="module-GetValue.html#.getMinuteCount">getMinuteCount</a></li><li data-type='method'><a href="module-GetValue.html#.getSize">getSize</a></li><li data-type='method'><a href="module-GetValue.html#.getValueMax">getValueMax</a></li><li data-type='method'><a href="module-GetValue.html#.getValueMin">getValueMin</a></li><li data-type='method'><a href="module-GetValue.html#.getZipDay">getZipDay</a></li><li data-type='method'><a href="module-GetValue.html#.matchDayToMon">matchDayToMon</a></li><li data-type='method'><a href="module-GetValue.html#.matchDayToWeek">matchDayToWeek</a></li><li data-type='method'><a href="module-GetValue.html#.outputDay5">outputDay5</a></li><li data-type='method'><a href="module-GetValue.html#.transExrightDay">transExrightDay</a></li><li data-type='method'><a href="module-GetValue.html#.transExrightMin">transExrightMin</a></li><li data-type='method'><a href="module-GetValue.html#.updateStatic">updateStatic</a></li><li data-type='method'><a href="module-GetValue.html#~_getExrightPara">_getExrightPara</a></li><li data-type='method'><a href="module-GetValue.html#~_getExrightPrice">_getExrightPrice</a></li><li data-type='method'><a href="module-GetValue.html#~_isRight">_isRight</a></li></ul></li><li><a href="module-SeerConfig.html">SeerConfig</a></li><li><a href="module-SystemConfig.html">SystemConfig</a><ul class='methods'><li data-type='method'><a href="module-SystemConfig.html#._getOtherTxtWidth">_getOtherTxtWidth</a></li><li data-type='method'><a href="module-SystemConfig.html#.changeCursorStyle">changeCursorStyle</a></li><li data-type='method'><a href="module-SystemConfig.html#.checkLayout">checkLayout</a></li><li data-type='method'><a href="module-SystemConfig.html#.getLineColor">getLineColor</a></li><li data-type='method'><a href="module-SystemConfig.html#.initCommonInfo">initCommonInfo</a></li><li data-type='method'><a href="module-SystemConfig.html#.initSystem">initSystem</a></li><li data-type='method'><a href="module-SystemConfig.html#.setColor">setColor</a></li><li data-type='method'><a href="module-SystemConfig.html#.setScale">setScale</a></li><li data-type='method'><a href="module-SystemConfig.html#.setStandard">setStandard</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#_getDistance">_getDistance</a></li><li><a href="global.html#_getRotateDirection">_getRotateDirection</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">event/cl.event.handler.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Copyright (c) 2018-present clchart Contributors.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

/*
  The canvas needs to have two methods
  eventCanvas: {
    addEventListener: () => {},
    removeEventListener: () => {}
  }
*/

/*
  // Event object required attributes
  event: {
    touches: [
      pageX: 0,
      pageY: 0,
      offsetX: 0,
      offsetY: 0,
    ],
    changedTouches: [],
    target: {
      getBoundingClientRect: () => {}
    },
    preventDefault: () => {}
  }
*/

/**
 * Get distance
 * @param {Number} xLen
 * @param {Number} yLen
 * @return {Number}
 */
function _getDistance (xLen, yLen) {
  return Math.sqrt(xLen * xLen + yLen * yLen)
}
/**
 * Get the rotation direction of the vector
 */
function _getRotateDirection (vector1, vector2) {
  return vector1.x * vector2.y - vector2.x * vector1.y
}

function _getRotateAngle (vector1, vector2) {
  let direction = _getRotateDirection(vector1, vector2)
  direction = direction > 0 ? -1 : 1
  const len1 = _getDistance(vector1.x, vector1.y)
  const len2 = _getDistance(vector2.x, vector2.y)
  const mr = len1 * len2
  if (mr === 0) return 0
  const dot = vector1.x * vector2.x + vector1.y * vector2.y
  let r = dot / mr
  if (r > 1) r = 1
  if (r &lt; -1) r = -1
  return Math.acos(r) * direction * 180 / Math.PI
}

function _getTouchInfo (point, element) {
  const mouseInfo = {
    name: 'touch'
  }
  if (point.offsetX &amp;&amp; point.offsetX === 0) {
    mouseInfo.offsetX = point.offsetX
    mouseInfo.offsetY = point.offsetY
  } else {
    let srcRect = {
      left: 0,
      top: 0
    }
    if (element &amp;&amp; typeof element.getBoundingClientRect === 'function') srcRect = element.getBoundingClientRect()
    mouseInfo.offsetX = point.pageX - srcRect.left
    mouseInfo.offsetY = point.pageY - srcRect.top
  }
  return mouseInfo
}

function _getEventInfo (event) {
  return {
    offsetX: event.offsetX,
    offsetY: event.offsetY
  }
}

/**
 * Class representing ClEventHandler
 * @export
 * @class ClEventHandler
 */
export default class ClEventHandler {
  /**
   * Creates an instance of ClEventHandler.
   * @param {Object} {
   * father,
   * eventBuild,
   * isTouch
   * }
   * @constructor
   */
  constructor ({ father, eventBuild, isTouch }) {
    this.father = father
    this.eventCanvas = father.eventCanvas
    if (typeof eventBuild === 'function') {
      this.eventBuild = eventBuild
    } else {
      this.eventBuild = (e) => e
    }
    // Determine whether touch event is supported
    this.isTouch = !!isTouch

    // Remove long press popup button
    this.eventCanvas.addEventListener &amp;&amp; this.eventCanvas.addEventListener('contextmenu', e => {
      e.preventDefault()
    })
  }
  /**
   * bind evnet
   * @memberof ClEventHandler
   */
  bindEvent () {
    if (this.isTouch) {
      this.addHandler('touchstart', this.touchstart.bind(this))
      this.addHandler('touchend', this.touchend.bind(this))
      this.addHandler('touchmove', this.touchmove.bind(this))
    } else {
      this.addHandler('mousemove', this.mousemove.bind(this))
      // this.addHandler('mousein', this.mousein.bind(this));
      this.addHandler('mouseout', this.mouseout.bind(this))
      this.addHandler('mousewheel', this.mousewheel.bind(this))
      this.addHandler('mouseup', this.mouseup.bind(this))
      this.addHandler('mousedown', this.mousedown.bind(this))
      this.addHandler('keyup', this.keyup.bind(this))
      this.addHandler('keydown', this.keydown.bind(this))

      this.addHandler('click', this.click.bind(this))
    }
  }
  /**
   * clear event listener
   * @memberof ClEventHandler
   */
  clearEvent () {
    if (this.isTouch) {
      this.clearHandler('touchstart', this.touchstart.bind(this))
      this.clearHandler('touchend', this.touchend.bind(this))
      this.clearHandler('touchmove', this.touchmove.bind(this))
    } else {
      this.clearHandler('mousemove', this.mousemove.bind(this))
      // this.clearHandler('mousein', this.mousein.bind(this));
      this.clearHandler('mouseout', this.mouseout.bind(this))
      this.clearHandler('mousewheel', this.mousewheel.bind(this))
      this.clearHandler('mouseup', this.mouseup.bind(this))
      this.clearHandler('mousedown', this.mousedown.bind(this))
      this.clearHandler('keyup', this.keyup.bind(this))
      this.clearHandler('keydown', this.keydown.bind(this))

      this.clearHandler('click', this.click.bind(this))
    }
  }
  /**
   * add handle for events
   * @param {String} eventName
   * @param {Function} handler
   * @memberof ClEventHandler
   */
  addHandler (eventName, handler) {
    if (this.eventCanvas.addEventListener) {
      this.eventCanvas.addEventListener(eventName, handler, false)
    } else if (this.eventCanvas.attachEvent) {
      this.eventCanvas.attachEvent('on' + eventName, handler)
    } else {
      this.eventCanvas['on' + eventName] = handler
    }
  }
  /**
   * Clean up all binding events
   * @param {String} eventName
   * @param {Function} handler
   * @memberof ClEventHandler
   */
  clearHandler (eventName, handler) {
    if (this.eventCanvas.removeEventListener) {
      this.eventCanvas.removeEventListener(eventName, handler, false)
    } else if (this.eventCanvas.deattachEvent) {
      this.eventCanvas.deattachEvent('on' + eventName, handler)
    } else {
      this.eventCanvas['on' + eventName] = null
    }
  }
  // The following is an event handler
  /**
   * mouse move
   * @param {Object} event
   * @memberof ClEventHandler
   */
  mousemove (event) {
    this.father.emitEvent('onMouseMove', _getEventInfo(event))
  }
  /**
   * mouse in
   * @param {Object} event
   * @memberof ClEventHandler
   */
  mousein (event) {
    this.father.emitEvent('onMouseIn', _getEventInfo(event))
  }
  /**
   * mouse out
   * @param {Object} event
   * @memberof ClEventHandler
   */
  mouseout (event) {
    this.father.emitEvent('onMouseOut', _getEventInfo(event))
  }
  /**
   * mouse whell
   * @param {Object} event
   * @memberof ClEventHandler
   */
  mousewheel (event) {
    const info = _getEventInfo(event)
    info.deltaY = event.deltaY
    this.father.emitEvent('onMouseWheel', info)
  }
  /**
   * mouse up
   * @param {Object} event
   * @memberof ClEventHandler
   */
  mouseup (event) {
    this.father.emitEvent('onMouseUp', _getEventInfo(event))
  }
  /**
   * mouse down
   * @param {Object} event
   * @memberof ClEventHandler
   */
  mousedown (event) {
    this.father.emitEvent('onMouseDown', _getEventInfo(event))
  }
  // keyboard event
  /**
   * key up
   * @param {Object} event
   * @memberof ClEventHandler
   */
  keyup (event) {
    const info = _getEventInfo(event)
    info.keyCode = event.keyCode
    this.father.emitEvent('onKeyUp', info)
  }
  /**
   * key down
   * @param {Object} event
   * @memberof ClEventHandler
   */
  keydown (event) {
    const info = _getEventInfo(event)
    info.keyCode = event.keyCode
    this.father.emitEvent('onKeyDown', info)
  }
  /**
   * click event
   * @param {Object} event
   * @memberof ClEventHandler
   */
  click (event) {
    this.father.emitEvent('onClick', _getEventInfo(event))
  }
  /**
   * touchstart
   * @param {Object} e
   * @memberof ClEventHandler
   */
  touchstart (e) {
    const event = this.eventBuild(e)
    this.__timestamp = new Date()
    const point = event.touches ? event.touches[0] : event
    this.startX = point.pageX
    this.startY = point.pageY
    clearTimeout(this.longTapTimeout)
    this.startTime = Date.now()
    // Two-point touch
    if (event.touches.length > 1) {
      const point2 = event.touches[1]
      const xLen = Math.abs(point2.pageX - this.startX)
      const yLen = Math.abs(point2.pageY - this.startY)
      this.touchDistance = _getDistance(xLen, yLen)
      this.touchVector = {
        x: point2.pageX - this.startX,
        y: point2.pageY - this.startY
      }
    } else {
      this.longTapTimeout = setTimeout(() => {
        this.father.emitEvent('onLongPress', _getTouchInfo(point, event.target))
      }, 600)
      if (this.previousTouchPoint) {
        if (Math.abs(this.startX - this.previousTouchPoint.startX) &lt; 10 &amp;&amp;
          Math.abs(this.startY - this.previousTouchPoint.startY) &lt; 10 &amp;&amp;
          Math.abs(this.startTime - this.previousTouchTime) &lt; 300) {
          this.father.emitEvent('onDoubleClick', _getTouchInfo(point, event.target))
        }
      }
      this.previousTouchTime = this.startTime
      this.previousTouchPoint = {
        startX: this.startX,
        startY: this.startY
      }
    }
  }
  /**
   * touchend
   * @param {Object} e
   * @memberof ClEventHandler
   */
  touchend (e) {
    const event = this.eventBuild(e)
    clearTimeout(this.longTapTimeout)
    const point = event.changedTouches ? event.changedTouches[0] : event
    const timestamp = Date.now()
    if ((this.moveX !== null &amp;&amp; Math.abs(this.moveX - this.startX) > 10) ||
      (this.moveY !== null &amp;&amp; Math.abs(this.moveY - this.startY) > 10)) {
      if (timestamp - this.startTime &lt; 500) {
        this.father.emitEvent('onSwipe', _getTouchInfo(point, event.target))
      }
    } else if (timestamp - this.startTime &lt; 2000) {
      if (timestamp - this.startTime &lt; 500) {
        this.father.emitEvent('onClick', _getTouchInfo(point, event.target))
      }
      if (timestamp - this.startTime > 500) {
        this.father.emitEvent('onLongPress', _getTouchInfo(point, event.target))
      }
    }
    this.startX = this.startY = this.moveX = this.moveY = null
    this.previousPinchScale = 1
    this.father.emitEvent('onMouseOut', _getTouchInfo(point, event.target))
  }
  /**
   * touchmove
   * @param {Object} e
   * @memberof ClEventHandler
   */
  touchmove (e) {
    const event = this.eventBuild(e)
    if (new Date() - this.__timestamp &lt; 150) {
      return event
    }
    const timestamp = Date.now()
    if (event.touches.length > 1) {
      const xLen = Math.abs(event.touches[0].pageX - event.touches[1].pageX)
      const yLen = Math.abs(event.touches[0].pageY - event.touches[1].pageY)
      const touchDistance = _getDistance(xLen, yLen)
      // Calculate scaling events
      if (this.touchDistance) {
        const pinchScale = touchDistance / this.touchDistance
        const point = event.touches ? event.touches[0] : event
        // this._emitEvent('onPinch', { scale: pinchScale - this.previousPinchScale }); // 缩放
        const mouseinfo = _getTouchInfo(point, event.target)
        if ((timestamp - this.startTime) > 90 &amp;&amp; this.previousPinchScale) {
          mouseinfo.scale = pinchScale - this.previousPinchScale
          if (Math.abs(mouseinfo.scale) > 0.01) {
            this.father.emitEvent('onPinch', mouseinfo)
          }
          this.startTime = Date.now()
        }
        this.previousPinchScale = pinchScale
      }
      // Calculating rotation events
      if (this.touchVector) {
        const vector = {
          x: event.touches[1].pageX - event.touches[0].pageX,
          y: event.touches[1].pageY - event.touches[0].pageY
        }
        const angle = _getRotateAngle(vector, this.touchVector)
        // this._emitEvent('onRotate', {
        //   angle
        // })
        this.father.emitEvent('onRotate', {
          angle
        })
        this.touchVector.x = vector.x
        this.touchVector.y = vector.y
      }
    } else {
      clearTimeout(this.longTapTimeout)
      const point = event.touches ? event.touches[0] : event
      const deltaX = this.moveX === null ? 0 : point.pageX - this.moveX
      const deltaY = this.moveY === null ? 0 : point.pageY - this.moveY
      // this._emitEvent('onMove', { deltaX, deltaY });
      const config = _getTouchInfo(point, event.target)
      config.deltaX = deltaX
      config.deltaY = deltaY
      this.father.emitEvent('onMouseMove', config)
      this.moveX = point.pageX
      this.moveY = point.pageY
    }
    if (typeof event.preventDefault === 'function') event.preventDefault()
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Nov 11 2018 17:20:33 GMT+0800 (CST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>


</body>
</html>
